<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="icon" href="">
    <style>
        *{
            padding: 0;
            margin: 0;
            border: none;
            box-sizing: border-box;
            
        }
        html{
            font-size: 22px;
        }
       
        .login{
            width: 350px;
            background-color: white;
            height: 60vh;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translateX(-50%)translateY(-50%) ;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow:0 0 7px 0.05px rgba(95, 95, 119, 0.603) ;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 25px;
        }
        input{
            padding: 10px;
            border-radius: 3px;
            border: 1px solid gray;
            font-size: 1rem;
        }
        #email{
            margin-bottom: 20px;
        }
        button{
            margin-top: 40px;
            padding: 10px;
            cursor: pointer;
            border-radius: 3px;
            background-color: blue;
            color: white;
            transition: 0.1s;
            font-weight: 500;
            border: 3px blue solid;
            font-size: 1rem;
        }
        button:hover{
           /* scale: 1.02; */
           background-color: transparent;
           color: blue;
           
        }
        form{
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        @keyframes notify {
            0%{
                transform: translateY(0px);
                opacity: 0;
            }
            100%{
                transform: translateY(20px);
                opacity: 1;
            }
        }
        h3{
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login">
            <h3>Register</h3>
            <form action="" >
                <input type="email" placeholder="Email" id="email" required>
                <input type="password" name="password" id="password" placeholder="Password" required>
                <input type="password" name="password" id="re-password" placeholder="re-Password">
                <!-- HTML: ضيف ده جوه <body> -->
                <div id="notification" style="
                    position: fixed;
                    animation:notify 0.4s linear forwards;
                    right: 0.5px;
                    top: 4px;
                    background-color: green;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 5px;
                    display: none;
                    box-shadow: 0 0 10px rgba(0,0,0,0.2);
                    font-weight: bold;
                    z-index: 1000;"
                >
                Registered Successfully!
                </div>

                <button type="button" id="submit" onclick="Register()">Sign Up</button>
                <p>already have an account?<a href="Login.html">Login</a></p>
            </form>
            
            
        </div>
    </div>
    <script>
        const pass = document.querySelector('#password');
        const email = document.querySelector('#email');
        const re_pass = document.querySelector('#re-password');
        const submit= document.querySelector('#submit');
        const msg = document.querySelector('#notification');
        const form = document.querySelector('form');
        let arr=[];
        let attempts = 0;
        async function Getusers(){
            const res = await fetch("https://69558fd4b9b81bad7af122d4.mockapi.io/Projects/users");
            arr =await res.json();
            return arr;
        }
        arr =Getusers();
         attempts = 0;

function handleLogin() {
  attempts++;

  if (attempts >= 3) {
    
    submit.disabled=true;
    msg.innerHTML="Too many attempts TRY AGAIN AFTER 30s";
                msg.style.display="block";
                msg.style.backgroundColor="red";
    setTimeout(() => {
      attempts = 0;
      loginBtn.disabled = false;

    }, 30000);
  }
}

        form.addEventListener("submit",async function (e) {
            e.preventDefault();
        })
        function Register(){
            handleLogin();
            if (pass.value != re_pass.value || pass.value =='' || email.value == '' ){
                msg.innerHTML="the passwords doesn't match or you need to fill it!!!";
                msg.style.display="block";
                msg.style.backgroundColor="red";
                setTimeout(function(){
                        msg.style.display="none";

                    },2000)
                setTimeout(function(){
                        msg.style.display="none";

                    },2000)
               
                re_pass.focus();
                return;
            }
            else if (pass.value.length<8){
                msg.innerHTML="Password must be at least 8 characters";
                msg.style.display="block";
                msg.style.backgroundColor="red";
                setTimeout(function(){
                        msg.style.display="none";
                    },3000)
                re_pass.focus();
                return;
            }
            for(let i=0;i<arr.length;i++){
                
                if(arr[i].email ===email.value){
                    msg.innerHTML="This Email already Exists!!";
                    msg.style.backgroundColor="red";
                    msg.style.display="block";
                    setTimeout(function(){
                        msg.style.display="none";

                    },3000)
                    console.log(arr);
                    return;
                }
            }
        
        fetch("https://69558fd4b9b81bad7af122d4.mockapi.io/Projects/users",{
            method: "Post",
            headers:{
                "Content-Type":"application/json"
            },
            body:JSON.stringify({
                email:email.value,
                password:pass.value
            })
        }
        ).then(res => {
            if (!res.ok) throw new Error("Request failed");
            return res.json();
        })
        .then(data => {
            msg.innerHTML ="Registered successfully!";
            msg.style.display ="block";
            msg.style.backgroundColor="green";
            
            setTimeout(function(){window.location.href="Login.html";},3000);
        })
        .catch(err => console.log(err));
        }
    </script>
    
</body>
</html>